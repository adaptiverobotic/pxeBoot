#!/bin/bash
# -----------------------------------------------------------------------------
# 30-postInstall-createinterfaces
#
# This is one of a series of scripts that live in /root/postInstall. They are
# placed there to avoid being read by casual users and are intended to be
# executed immediately after the VM is created to set up host specific 
# configuration.
#
# Checks to see if there's a backup for /etc/network/interfaces - if not then
# it backs up the original interfaces if it exists and writes out a new one
# -----------------------------------------------------------------------------

. /root/postInstall/postInstall-setupvars

# -----------------------------------------------------------------------------
# Check if there's already a backup - return immediately if there is

if [[ -e "${postInstallBackupDir}/etc/network/interfaces" ]]; then
    echo "Backup of /etc/network/interfaces already exists - exiting"
    return
fi

if [[ -e "/etc/network/interfaces" ]]; then
    cp --parents "/etc/network/interfaces" "${postInstallBackupDir}"    
fi

echo "Create new /etc/network/interfaces"

cat <<END-OF-FILE > "/etc/network/interfaces"
# Autogenerated by /root/postInstall/10-postInstall-createinterfaces - if you need
# to add more entries, consider updating the script!
#
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

# The vboxnet host-only interface
auto eth0
allow-hotplug eth0
iface eth0 inet static
    address ${myIPAddress}
    netmask 255.255.255.0

# The bridged interface
allow-hotplug eth1
iface eth1 inet dhcp

# The NAT interface
allow-hotplug eth2
iface eth2 inet dhcp
END-OF-FILE

# -----------------------------------------------------------------------------
