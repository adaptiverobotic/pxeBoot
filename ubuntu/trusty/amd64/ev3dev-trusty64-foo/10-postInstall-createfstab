#!/bin/dash
# -----------------------------------------------------------------------------
# 10-postInstall-createfstab
#
# This is one of a series of scripts that live in /root/postInstall. They are
# placed there to avoid being read by casual users and are intended to be
# executed immediately after the VM is created to set up host specific 
# configuration.
#
# Checks to see if there's a backup for /etc/fstab - if not then it
# backs up the original hosts if it exists and writes out a new one
# -----------------------------------------------------------------------------

. /root/postInstall/postInstall-setupvars

# -----------------------------------------------------------------------------
# Check if there's already a backup - return immediately if there is

if [ -e ${postInstallBackupDir}/etc/fstab ]; then
    echo "Backup of /etc/fstab already exists - exiting"
    return
fi

if [ -e /etc/fstab ]; then
    cp --parents /etc/fstab ${postInstallBackupDir}    
fi

# -----------------------------------------------------------------------------
# Update the NFS record in /fstab - force nfs3 mounts
#
# Note: Another way around mounting using nfs3 is to write a little sed script
#       to force NEED_IDMAPD=yes in /etc/deault/nfs-common
#

cat <<END-OF-FILE >> /etc/fstab
# Autogenerated by /root/postInstall/10-postInstall-createfstab - if you need
# to add more entries, consider updating the script!
#
# Mount nfs share from VirtualBox host
${hostIPAddress}:${hostNFSDirectory} ${myNFSDirectory} nfs vers=3 0 0
END-OF-FILE

# -----------------------------------------------------------------------------
