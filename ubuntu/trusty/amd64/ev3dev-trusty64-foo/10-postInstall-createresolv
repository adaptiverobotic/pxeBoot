#!/bin/dash
# -----------------------------------------------------------------------------
# 10-postInstall-createresolv
#
# This is one of a series of scripts that live in /root/postInstall. They are
# placed there to avoid being read by casual users and are intended to be
# executed immediately after the VM is created to set up host specific 
# configuration.
#
# Checks to see if there's a backup for /etc/resolv.conf - if not then it
# backs up the original resolv.conf if it exists and writes out a new one
# -----------------------------------------------------------------------------

. /root/postInstall/postInstall-setupvars

# -----------------------------------------------------------------------------
# Check if there's already a backup - return immediately if there is

if [ -e ${postInstallBackupDir}/etc/resolv.conf ]; then
    echo "Backup of /etc/resolv.conf already exists - exiting"
    return
fi

if [ -e /etc/resolv.conf ]; then
    cp --parents /etc/resolv.conf ${postInstallBackupDir}    
fi

echo "Create new /etc/resolv.conf"

cat <<END-OF_FILE > /etc/resolv.conf
# Autogenerated by /root/postInstall/10-postInstall-createresolv - but it's
# likely to get overwritten - this is just for the first reboot
#
#Default google dns servers - IPV4
nameserver 8.8.8.8
nameserver 8.8.4.4

#Default google dns servers - IPV6

nameserver 2001:4860:4860::8888
nameserver 2001:4860:4860::8844
END-OF_FILE

# -----------------------------------------------------------------------------
