#!/usr/bin/env bash
# -----------------------------------------------------------------------------
# 11-postInstall-append-fstab-nfs
#
# This is one of a series of scripts that live in /root/postInstall. They are
# placed there to avoid being read by casual users and are intended to be
# executed immediately after the VM is created to set up host specific 
# configuration.
#
# Checks to see if there's a backup for /etc/fstab - if not then it
# backs up the original hosts if it exists and writes out a new one
#
# Copyright (C) 2014-2015 Ralph Hempel <rhempel@hempeldesigngroup.com>
#
# See LICENSE for https://github.com/rhempel/pxeBoot
# -----------------------------------------------------------------------------

. /root/postInstall/postInstall-setupvars

# -----------------------------------------------------------------------------
# Update the NFS record in /fstab - force nfs3 mounts
#
# Note: Another way around mounting using nfs3 is to write a little sed script
#       to force NEED_IDMAPD=yes in /etc/default/nfs-common

FILE="/etc/fstab"

echo "Appending to \"${FILE}\""

cat <<END-OF-FILE >> "${FILE}"
# -----------------------------------------------------------------------------
# Autogenerated by $0
#
# If you need to change things, consider updating the script or adding
# a custom script to your VM postInstall folder.
#
# Mount nfs share from VirtualBox host

${hostIPAddress}:${hostNFSDirectory} ${vmNFSDirectory} nfs vers=3 0 0
${hostIPAddress}:/srv/nfs/arm-2011.03 /opt/arm-2011.03 nfs vers=3 0 0

END-OF-FILE

# -----------------------------------------------------------------------------
